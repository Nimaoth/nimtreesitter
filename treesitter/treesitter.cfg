[n.global]
output = treesitter

[n.include]
$output/include
$output/include/tree_sitter
$output/src
$output/utf8proc

[n.prepare]
gitremote.ts = "https://github.com/tree-sitter/tree-sitter/"
gitsparse.ts = """
include/*
src/runtime/*
"""

gitoutput = utf8proc
gitremote.ut = "https://github.com/JuliaStrings/utf8proc"
gitsparse.ut = """
*.c
*.h
"""

[utf8proc_data.c]
prepend = "#include \"utf8proc.h\"\n"
noprocess = true

[treesitter/src/runtime/stack.c]
search-win = "inline Stack"
replace-win = Stack
noprocess = true

[runtime.h]
preprocess = true
defines = true
recurse = true

compile = $output/src/runtime/runtime.c

flags = "--stdcall --nep1"
pragma = "passC: \"-DUTF8PROC_STATIC -std=gnu++14\""

[runtime.nim]
regex.1 = """([u]?int[\d]+)T"""
replace.1 = $1

search.2 = Bool
replace.2 = bool

regex.3 = """= tS[a-zA-Z]+"""
replace.3 = "= object"